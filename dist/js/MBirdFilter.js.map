{"version":3,"names":[],"mappings":"","sources":["MBirdFilter.js"],"sourcesContent":["class MBirdFilter {\r\n\tconstructor() {\r\n\t\tthis.filterFormData = jQuery('#mbird-filter-form').serialize();\r\n\t\tthis.currentPage = 1;\r\n\t\tthis.postsPerPage = 9; // Set this to match the posts_per_page value in the shortcode\r\n\t\tthis._init();\r\n\t}\r\n\r\n\t_init() {\r\n\t\t// prevent form submission\r\n\t\tjQuery('#mbird-filter-form').on('submit', (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t});\r\n\r\n\t\t// on form change run the filters\r\n\t\tjQuery('#mbird-filter-form').on('change', (event) => {\r\n\t\t\tevent.preventDefault();\r\n\r\n\t\t\tthis._runFilters();\r\n\t\t});\r\n\r\n\t\t// Load initial data\r\n\t\tthis._loadData();\r\n\r\n\t\t// Add event listener for Load More button\r\n\t\tjQuery('#mbird-load-more').on('click', (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tthis.currentPage++;\r\n\t\t\tthis._loadData();\r\n\t\t});\r\n\r\n\t\tjQuery('#mbird-filter-reset').on('click', (event) => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tthis._resetFilters();\r\n\t\t});\r\n\t}\r\n\r\n\t_loadData() {\r\n\t\tjQuery(\"#mbird-filter-loader\").show();\r\n\r\n\t\tconst shortcodeAtts = jQuery('input[name=\"shortcode_atts\"]').val();\r\n\r\n\t\tjQuery.ajax({\r\n\t\t\turl: mbirdFilters.ajaxurl, // use localized ajaxurl\r\n\t\t\ttype: 'POST',\r\n\t\t\tdata: {\r\n\t\t\t\taction: 'mbird_initial_load',\r\n\t\t\t\tsecurity: jQuery('#mbird_filter_nonce_field').val(),\r\n\t\t\t\tshortcode_atts: shortcodeAtts,\r\n\t\t\t\tpage: this.currentPage // Include current page in the request\r\n\t\t\t},\r\n\t\t\tsuccess: (response) => {\r\n\t\t\t\t// if there are posts to display, append them to the list\r\n\t\t\t\tif(response) {\r\n\t\t\t\t\tjQuery('#mbird-filter-results').append(response);\r\n\r\n\t\t\t\t\t// Check if the number of posts returned is less than postsPerPage\r\n\t\t\t\t\tif (jQuery(response).length < this.postsPerPage) {\r\n\t\t\t\t\t\tjQuery('#mbird-load-more').hide();\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// if no more posts, remove the button and show no more posts text\r\n\t\t\t\t\tjQuery('#mbird-load-more').hide();\r\n\t\t\t\t\tjQuery('#mbird-filter-results').html('<p class=\"no-results\">No posts found.</p>');\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\terror: function(xhr, status, error) {\r\n\t\t\t\tconsole.error('AJAX error:', status, error);\r\n\t\t\t},\r\n\t\t\tcomplete: () => {\r\n\t\t\t\tjQuery('#mbird-filter-loader').hide();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t_runFilters() {\r\n\t\tconst filterData = jQuery('#mbird-filter-form').serializeArray();\r\n\t\tlet shortcodeAtts = JSON.parse(jQuery('input[name=\"shortcode_atts\"]').val());\r\n\r\n\t\t// Reset terms in tax_query\r\n\t\tObject.keys(shortcodeAtts.tax_query).forEach(key => {\r\n\t\t\tif (Array.isArray(shortcodeAtts.tax_query[key].terms)) {\r\n\t\t\t\tshortcodeAtts.tax_query[key].terms = [];\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tconst urlParams = new URLSearchParams(window.location.search);\r\n\t\tconst taxonomyParams = {};\r\n\r\n\t\t// Clear existing filter parameters from URL\r\n\t\tObject.keys(shortcodeAtts.tax_query).forEach(key => {\r\n\t\t\tconst taxonomy = shortcodeAtts.tax_query[key].taxonomy;\r\n\t\t\turlParams.delete(taxonomy);\r\n\t\t});\r\n\r\n\t\tfilterData.forEach(item => {\r\n\t\t\tif (item.name.startsWith('filter-')) {\r\n\t\t\t\tconst key = item.name.replace('filter-', '');\r\n\t\t\t\tObject.keys(shortcodeAtts.tax_query).forEach(taxKey => {\r\n\t\t\t\t\tif (shortcodeAtts.tax_query[taxKey].taxonomy === key) {\r\n\t\t\t\t\t\tshortcodeAtts.tax_query[taxKey].terms.push(item.value);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tif (!taxonomyParams[key]) {\r\n\t\t\t\t\ttaxonomyParams[key] = [];\r\n\t\t\t\t}\r\n\t\t\t\ttaxonomyParams[key].push(item.value);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Update the URL with the new parameters\r\n\t\tObject.keys(taxonomyParams).forEach(key => {\r\n\t\t\turlParams.set(key, taxonomyParams[key].join(','));\r\n\t\t});\r\n\t\tconst newUrl = decodeURIComponent(`${window.location.pathname}${urlParams.toString() ? '?' + urlParams.toString() : ''}`);\r\n\t\thistory.pushState(null, '', newUrl);\r\n\r\n\t\tjQuery('input[name=\"shortcode_atts\"]').val(JSON.stringify(shortcodeAtts));\r\n\r\n\t\tthis.currentPage = 1; // Reset to the first page\r\n\t\tjQuery('#mbird-filter-results').empty(); // Clear previous results\r\n\t\tthis._loadData();\r\n\t}\r\n\r\n\t_resetFilters() {\r\n\t\tlet shortcodeAtts = JSON.parse(jQuery('input[name=\"shortcode_atts\"]').val());\r\n\r\n\t\t// Clear only the terms in tax_query\r\n\t\tObject.keys(shortcodeAtts.tax_query).forEach(key => {\r\n\t\t\tif (Array.isArray(shortcodeAtts.tax_query[key].terms)) {\r\n\t\t\t\tshortcodeAtts.tax_query[key].terms = [];\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Update the URL to remove filter parameters\r\n\t\tconst urlParams = new URLSearchParams(window.location.search);\r\n\t\tObject.keys(shortcodeAtts.tax_query).forEach(key => {\r\n\t\t\tconst taxonomy = shortcodeAtts.tax_query[key].taxonomy;\r\n\t\t\turlParams.delete(taxonomy);\r\n\t\t});\r\n\t\tconst newUrl = `${window.location.pathname}${urlParams.toString() ? '?' + urlParams.toString() : ''}`;\r\n\t\thistory.pushState(null, '', newUrl);\r\n\r\n\t\tjQuery('input[name=\"shortcode_atts\"]').val(JSON.stringify(shortcodeAtts));\r\n\t\tjQuery('#mbird-filter-form')[0].reset();\r\n\t\tthis.currentPage = 1;\r\n\t\tjQuery('#mbird-filter-results').empty();\r\n\t\tthis._loadData();\r\n\t}\r\n}"],"file":"MBirdFilter.js"}